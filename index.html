<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RepQR • Events Setup Prototype</title>
  <style>
    :root{
      --bg: #0b0f19;
      --panel: rgba(255,255,255,.04);
      --panel2: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.10);
      --border2: rgba(255,255,255,.16);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.64);
      --muted2: rgba(255,255,255,.48);
      --accent: #6ee7ff;
      --accent2: #a78bfa;
      --danger: #ff5a7a;
      --ok: #6ef7a6;
      --shadow: 0 24px 70px rgba(0,0,0,.55);
      --shadow2: 0 12px 24px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 14px;
      --ring: 0 0 0 4px rgba(110,231,255,.14);
      --ring2: 0 0 0 4px rgba(167,139,250,.14);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 800px at 10% 5%, rgba(110,231,255,.10), transparent 60%),
        radial-gradient(900px 700px at 90% 15%, rgba(167,139,250,.12), transparent 55%),
        radial-gradient(900px 700px at 50% 100%, rgba(255,255,255,.06), transparent 60%),
        var(--bg);
      color:var(--text);
      font-family:var(--font);
      letter-spacing:.2px;
    }

    .wrap{
      max-width: 1200px;
      margin: 28px auto;
      padding: 0 18px 40px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:18px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .logo{
      width:38px;height:38px;border-radius:12px;
      background: linear-gradient(135deg, rgba(110,231,255,.95), rgba(167,139,250,.92));
      box-shadow: 0 16px 50px rgba(110,231,255,.18);
    }
    .brand h1{
      font-size:16px;
      margin:0;
      line-height:1.2;
      letter-spacing:.6px;
    }
    .brand small{
      display:block;
      margin-top:2px;
      color:var(--muted);
      font-size:12px;
      letter-spacing:.4px;
    }

    .layout{
      display:grid;
      grid-template-columns: 1fr;
      gap:18px;
      align-items:start;
    }
    .registrationHero{
      text-align:center;
      padding:32px 24px 40px;
      margin-bottom:8px;
    }
    .registrationHero h1{
      margin:0 0 12px;
      font-size:28px;
      font-weight:800;
      letter-spacing:-0.02em;
      line-height:1.2;
      color: rgba(255,255,255,.95);
    }
    .registrationHero .heroSub{
      margin:0;
      font-size:15px;
      color: var(--muted);
      max-width:480px;
      margin-left:auto;
      margin-right:auto;
    }

    /* Registration 2-panel layout */
    .regTwoCol{
      display:grid;
      grid-template-columns: 30% 70%;
      gap:20px;
      align-items:start;
    }
    @media (max-width: 900px){ .regTwoCol{ grid-template-columns: 35% 65%; } }
    @media (max-width: 640px){ .regTwoCol{ grid-template-columns: 1fr; } }

    .stepRail{
      position:relative;
      padding-left:0;
    }
    .stepRail::before{
      content:"";
      position:absolute;
      left:11px;
      top:20px;
      bottom:20px;
      width:2px;
      background: rgba(255,255,255,.1);
      border-radius:1px;
    }
    .stepCard{
      position:relative;
      display:block;
      width:100%;
      text-align:left;
      padding:14px 16px 14px 32px;
      margin-bottom:8px;
      border-radius: var(--radius2);
      border:1px solid transparent;
      background: rgba(255,255,255,.04);
      cursor:pointer;
      transition: border-color .15s ease, background .15s ease;
    }
    .stepCard:hover{
      background: rgba(255,255,255,.07);
      border-color: rgba(255,255,255,.1);
    }
    .stepCard.active{
      border-color: var(--accent);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 1px rgba(110,231,255,.15);
    }
    .stepCard .stepDot{
      position:absolute;
      left:10px;
      top:50%;
      transform: translateY(-50%);
      width:10px;
      height:10px;
      border-radius:50%;
      background: rgba(255,255,255,.2);
    }
    .stepCard .stepDot[data-status="in_progress"]{ background: var(--accent); box-shadow: 0 0 0 2px rgba(110,231,255,.3); }
    .stepCard .stepDot[data-status="complete"]{ background: var(--ok); }
    .stepCard .stepCardTitle{ font-size:13px; font-weight:700; margin:0 0 2px; color: rgba(255,255,255,.92); }
    .stepCard .stepCardSubtitle{ font-size:11px; color: var(--muted); margin:0 0 6px; line-height:1.3; }
    .stepCard .stepCardStatusLine{ font-size:11px; margin:0; color: var(--muted); }
    .stepCard .stepCardStatusLine.complete{ color: var(--ok); }

    .editorCol .card{ margin:0; }
    .editorActions{ display:flex; justify-content:space-between; margin-top:16px; padding-top:14px; border-top:1px solid rgba(255,255,255,.08); }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.035));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .cardHead{
      padding:18px 18px 14px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .cardHead h2{
      margin:0;
      font-size:15px;
      letter-spacing:.5px;
    }
    .cardHead p{
      margin:6px 0 0;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.35;
      max-width: 58ch;
    }

    .pill{
      font-size:11px;
      color: rgba(255,255,255,.84);
      padding:7px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      white-space:nowrap;
    }

    .cardBody{padding:16px 18px 18px}

    /* Accordion */
    .section{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: var(--radius2);
      overflow:hidden;
      margin-bottom:12px;
    }

    .secHeader{
      width:100%;
      text-align:left;
      appearance:none;
      border:0;
      background: transparent;
      color: var(--text);
      padding:14px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      cursor:pointer;
    }
    .secHeader .secTitle{ flex:1; min-width:0; }

    .secHeader:hover{
      background: rgba(255,255,255,.03);
    }

    .secTitle{
      display:flex;
      flex-direction:column;
      gap:3px;
    }
    .secTitle strong{
      font-size:13px;
      letter-spacing:.4px;
    }
    .secTitle span{
      font-size:12px;
      color: var(--muted);
    }

    .secStatus{
      width:10px;height:10px;
      border-radius:50%;
      flex:0 0 auto;
    }
    .secStatus[data-status="not_started"]{ background: rgba(255,255,255,.2); }
    .secStatus[data-status="in_progress"]{ background: var(--accent); box-shadow: 0 0 8px rgba(110,231,255,.5); }
    .secStatus[data-status="complete"]{ background: var(--ok); box-shadow: 0 0 8px rgba(110,247,166,.4); }

    .secMissing{
      font-size:12px;
      color: var(--muted2);
      margin-top:6px;
      line-height:1.35;
    }
    .secMissing:empty{ display:none; }

    .chev{
      width:34px;height:34px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      display:grid;place-items:center;
      transition: transform .15s ease;
      flex: 0 0 auto;
    }

    .section[data-open="true"] .chev{
      transform: rotate(180deg);
    }

    .secBody{
      padding: 0 14px 14px;
      display:none;
    }
    .section[data-open="true"] .secBody{display:block}

    /* Form controls */
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 560px){
      .grid2{grid-template-columns:1fr}
    }

    label{
      display:block;
      font-size:12px;
      color: var(--muted);
      margin-bottom:7px;
      letter-spacing:.25px;
    }

    .field{margin-bottom:12px}

    input[type="text"], input[type="number"], input[type="date"], input[type="time"], select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      box-shadow: none;
      transition: border-color .12s ease, box-shadow .12s ease;
    }
    textarea{min-height:92px; resize: vertical}

    input:focus, select:focus, textarea:focus{
      border-color: rgba(110,231,255,.55);
      box-shadow: var(--ring);
    }

    .row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
    }

    .hint{
      font-size:12px;
      color: var(--muted2);
      margin-top:6px;
      line-height:1.35;
    }

    .divider{
      height:1px;
      background: rgba(255,255,255,.08);
      margin:12px 0;
    }

    /* Radios + toggles */
    .radioGroup{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .radio{
      position:relative;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      cursor:pointer;
      user-select:none;
    }
    .radio input{accent-color: #6ee7ff}
    .radio span{
      font-size:12.5px;
      color: rgba(255,255,255,.86);
      letter-spacing:.2px;
    }

    .toggle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      margin-bottom:10px;
    }
    .toggle strong{
      font-size:12.5px;
      font-weight:600;
      letter-spacing:.2px;
    }
    .toggle small{
      display:block;
      margin-top:3px;
      color: var(--muted2);
      font-size:12px;
      line-height:1.35;
    }

    .switch{
      width:44px;height:26px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      position:relative;
      flex: 0 0 auto;
      cursor:pointer;
    }
    .knob{
      width:22px;height:22px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      position:absolute;
      top:1px;left:1px;
      transition: transform .14s ease;
      box-shadow: 0 8px 16px rgba(0,0,0,.35);
    }
    .switch[data-on="true"]{
      background: linear-gradient(135deg, rgba(110,231,255,.55), rgba(167,139,250,.55));
      border-color: rgba(110,231,255,.55);
      box-shadow: var(--ring2);
    }
    .switch[data-on="true"] .knob{transform: translateX(18px)}

    /* Buttons */
    .actions{
      display:flex;
      gap:10px;
      justify-content:flex-end;
      margin-top:14px;
    }
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.90);
      padding:12px 14px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:650;
      letter-spacing:.35px;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
      transition: transform .06s ease, border-color .12s ease, background .12s ease;
    }
    .btn:hover{background: rgba(255,255,255,.085); border-color: rgba(255,255,255,.20)}
    .btn:active{transform: translateY(1px)}
    .btnPrimary{
      border:1px solid rgba(110,231,255,.36);
      background: linear-gradient(135deg, rgba(110,231,255,.18), rgba(167,139,250,.18));
      box-shadow: 0 18px 46px rgba(110,231,255,.10);
    }
    .btnPrimary:disabled{
      opacity:.5;
      cursor:not-allowed;
      transform:none;
    }
    .btnPrimary:disabled:hover{ background: linear-gradient(135deg, rgba(110,231,255,.18), rgba(167,139,250,.18)); border-color: rgba(110,231,255,.36); }

    .btnDanger{
      border:1px solid rgba(255,90,122,.35);
      background: rgba(255,90,122,.08);
    }

    /* Ticket tier rows */
    .tierRow{
      display:grid;
      grid-template-columns: 1.2fr .7fr .7fr auto;
      gap:10px;
      align-items:end;
      margin-bottom:10px;
    }
    @media (max-width: 760px){
      .tierRow{grid-template-columns:1fr 1fr; }
      .tierRow .tierRemove{grid-column: 1 / -1; justify-self: end}
    }

    /* Preview */
    .preview{
      position: sticky;
      top: 18px;
    }
    .preBox{
      padding:14px;
      border-radius: var(--radius2);
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      overflow:auto;
      max-height: 66vh;
      font-size:12px;
      color: rgba(255,255,255,.85);
      line-height:1.45;
      white-space: pre;
    }

    .mini{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .mini .pill{opacity:.95}

    /* Guidance block */
    .guidanceBlock{
      padding:20px 22px 24px;
      margin:0 18px 16px;
      border-radius: var(--radius2);
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
    }
    .guidanceBlock h3{
      margin:0 0 16px;
      font-size:16px;
      font-weight:700;
      letter-spacing:.3px;
      color: rgba(255,255,255,.9);
    }
    .guidanceBlock p{
      margin:0 0 12px;
      font-size:12px;
      color: var(--muted);
      line-height:1.4;
    }
    .guidanceBlock .guidanceStep{
      margin-bottom:16px;
      font-size:13px;
    }
    .guidanceBlock .guidanceStep:last-of-type{ margin-bottom:18px; }
    .guidanceBlock .guidanceStep strong{ display:block; margin-bottom:4px; color: rgba(255,255,255,.9); }
    .guidanceBlock .guidanceStep span{ color: var(--muted); font-size:12.5px; }
    .guidanceBlock .guidanceClosing{ margin:0; font-size:12px; color: var(--muted); padding-top:4px; }
    .flowIndicator{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      flex-wrap:wrap;
      font-size:11px;
      color: var(--muted2);
      letter-spacing:.2px;
    }
    .flowIndicator span{ white-space:nowrap; }
    .flowIndicator .arrow{ color: var(--accent); opacity:.8; }

    /* Active section */
    .section[data-open="true"]{
      border-color: rgba(110,231,255,.25);
      box-shadow: 0 0 0 1px rgba(110,231,255,.12);
    }
    .secConfiguring{
      display:block;
      font-size:11px;
      color: var(--accent);
      margin-top:4px;
      letter-spacing:.2px;
    }
    .secCompleteLabel{
      display:block;
      font-size:11px;
      color: var(--ok);
      margin-top:4px;
      letter-spacing:.2px;
    }
    .secConfiguring.hide, .secCompleteLabel.hide{ display:none !important; }

    /* Progress line above buttons */
    .progressLine{
      margin-top:16px;
      padding-top:14px;
      border-top:1px solid rgba(255,255,255,.08);
      font-size:12px;
      color: var(--muted);
      line-height:1.4;
    }
    .progressLine .count{ font-weight:600; color: rgba(255,255,255,.85); }
    .progressLine .next{ margin-top:4px; }

    /* Command Center */
    #commandCenterScreen .ccWrap{
      max-width: 1200px;
      margin: 28px auto;
      padding: 0 18px 40px;
    }
    #commandCenterScreen .ccHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:18px;
    }
    #commandCenterScreen .ccHeader h1{ margin:0; font-size:18px; letter-spacing:.3px; }
    #commandCenterScreen .ccHeader .ccActions{ display:flex; gap:10px; align-items:center; }
    #commandCenterScreen .ccLayout{
      display:flex;
      gap:0;
      min-height:70vh;
    }
    #commandCenterScreen .ccNav{
      width: 200px;
      flex-shrink:0;
      display:flex;
      flex-direction:column;
      gap:6px;
      padding-right:12px;
      border-right:1px solid rgba(255,255,255,.10);
    }
    #commandCenterScreen .ccNavBtn{
      width:100%;
      text-align:left;
      padding:12px 14px;
      border-radius: var(--radius2);
      border:1px solid transparent;
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-size:13px;
      font-weight:600;
      letter-spacing:.2px;
      cursor:pointer;
      transition: border-color .12s ease, background .12s ease;
    }
    #commandCenterScreen .ccNavBtn:hover{
      background: rgba(255,255,255,.08);
      border-color: rgba(255,255,255,.12);
    }
    #commandCenterScreen .ccNavBtn.active{
      border-color: rgba(110,231,255,.35);
      background: rgba(110,231,255,.1);
      color: rgba(255,255,255,.95);
    }
    #commandCenterScreen .ccContent{
      flex:1;
      min-width:0;
      padding-left:24px;
    }
    #commandCenterScreen .ccCard{ margin-bottom:16px; }
    #commandCenterScreen .ccDisabled{ font-size:12px; color: var(--muted2); font-style:italic; padding:12px; }
    #commandCenterScreen .ccContent{ transition: opacity .2s ease; }
    #commandCenterScreen .ccStatGrid{ display:grid; grid-template-columns: repeat(4, 1fr); gap:12px; margin-bottom:18px; }
    @media (max-width: 700px){ #commandCenterScreen .ccStatGrid{ grid-template-columns: repeat(2, 1fr); } }
    #commandCenterScreen .ccStatCard{ background: rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1); border-radius: var(--radius2); padding:14px 16px; }
    #commandCenterScreen .ccStatCard .ccStatValue{ font-size:22px; font-weight:800; letter-spacing:-0.02em; color: rgba(255,255,255,.95); }
    #commandCenterScreen .ccStatCard .ccStatLabel{ font-size:11px; text-transform:uppercase; letter-spacing:.05em; color: var(--muted); margin-top:4px; }
    #commandCenterScreen .ccActivityHeader{ display:flex; align-items:center; gap:8px; margin-bottom:10px; }
    #commandCenterScreen .ccPulse{ width:8px; height:8px; border-radius:50%; background: var(--ok); animation: ccPulse 1.5s ease-in-out infinite; }
    @keyframes ccPulse{ 0%,100%{ opacity:1; box-shadow: 0 0 0 0 rgba(110,247,166,.4); } 50%{ opacity:.85; } 70%{ box-shadow: 0 0 0 6px rgba(110,247,166,0); } }
    #commandCenterScreen .ccActivityItem{ font-size:12px; padding:8px 0; border-bottom:1px solid rgba(255,255,255,.06); color: var(--muted); }
    #commandCenterScreen .ccActivityItem:last-child{ border-bottom:none; }
    #commandCenterScreen .ccCallout{ font-size:12px; color: var(--muted); padding:10px 12px; background: rgba(255,255,255,.05); border-radius: var(--radius2); margin-bottom:12px; border:1px solid rgba(255,255,255,.08); }
    #commandCenterScreen .ccChecklist{ margin:0; padding-left:20px; font-size:13px; color: rgba(255,255,255,.88); }
    #commandCenterScreen .ccChecklist li{ margin-bottom:6px; }
    #commandCenterScreen .ccDemoToggle{ display:flex; align-items:center; gap:8px; font-size:12px; color: var(--muted); }
    #commandCenterScreen .ccHeader .pill{ margin-right:8px; }
    #commandCenterScreen .ccHeader .btnPrimary:disabled{ cursor:not-allowed; }
    #commandCenterScreen .ccPreviewFrame{ border:1px solid rgba(255,255,255,.12); border-radius: var(--radius2); overflow:hidden; background: rgba(0,0,0,.2); padding:20px; margin-bottom:16px; }
    #toastContainer{ position:fixed; top:16px; right:16px; z-index:9999; display:flex; flex-direction:column; gap:8px; max-width:320px; pointer-events:none; }
    #toastContainer .toast{ padding:12px 16px; border-radius: var(--radius2); background: var(--card); border:1px solid var(--border); box-shadow: var(--shadow2); font-size:13px; color: var(--text); animation: toastIn .25s ease; }
    #commandCenterScreen .table th, #commandCenterScreen .table td{ padding:8px 10px; text-align:left; border-bottom:1px solid rgba(255,255,255,.08); }
    #commandCenterScreen .table th{ color: var(--muted); font-weight:600; font-size:11px; text-transform:uppercase; letter-spacing:.04em; }
    @keyframes toastIn{ from{ opacity:0; transform: translateX(12px); } to{ opacity:1; transform: translateX(0); } }
    .resumeStrip{
      padding:10px 18px;
      margin:0 0 12px;
      border-radius: var(--radius2);
      background: rgba(110,231,255,.08);
      border:1px solid rgba(110,231,255,.2);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .resumeStrip.hide{ display:none !important; }
  </style>
</head>
<body>
  <div id="toastContainer"></div>
  <div id="registrationScreen">
  <div class="resumeStrip hide" id="resumeStrip">
    <span style="font-size:12px; color: var(--muted);">You have a saved event setup.</span>
    <button type="button" class="btn btnPrimary" id="resumeEventBtn">Resume Event</button>
  </div>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>RepQR • Events</h1>
          <small>Event setup prototype (looks-only)</small>
        </div>
      </div>
      <span class="pill">In-Person Events Only</span>
    </div>

    <div class="layout">
      <header class="registrationHero">
        <h1>Welcome to Your Event Registration</h1>
        <p class="heroSub">Let’s set up your in-person event. This only takes a few minutes.</p>
      </header>
      <div class="regTwoCol">
        <div class="stepRail">
          <button type="button" class="stepCard active" data-step="0">
            <span class="stepDot" data-status="not_started" id="stepDot0"></span>
            <strong class="stepCardTitle">Event Details</strong>
            <span class="stepCardSubtitle">Define when and where your event happens.</span>
            <p class="stepCardStatusLine" id="stepCard0Status">Missing: Event name, date, start time, timezone, location</p>
          </button>
          <button type="button" class="stepCard" data-step="1">
            <span class="stepDot" data-status="not_started" id="stepDot1"></span>
            <strong class="stepCardTitle">Attendance</strong>
            <span class="stepCardSubtitle">Decide how guests register and pay.</span>
            <p class="stepCardStatusLine" id="stepCard1Status">—</p>
          </button>
          <button type="button" class="stepCard" data-step="2">
            <span class="stepDot" data-status="not_started" id="stepDot2"></span>
            <strong class="stepCardTitle">Engagement</strong>
            <span class="stepCardSubtitle">Choose how you'll capture guests and track attendance.</span>
            <p class="stepCardStatusLine" id="stepCard2Status">—</p>
          </button>
          <button type="button" class="stepCard" data-step="3">
            <span class="stepDot" data-status="complete" id="stepDot3"></span>
            <strong class="stepCardTitle">System</strong>
            <span class="stepCardSubtitle">Enable sponsors and automated messaging.</span>
            <p class="stepCardStatusLine complete" id="stepCard3Status">✓ Section complete</p>
          </button>
        </div>
        <div class="editorCol">
          <div class="card">
            <div class="cardHead" id="editorHead">
              <div>
                <h2 id="editorStepTitle">Event Details</h2>
                <p id="editorStepSubtitle" style="margin:6px 0 0; font-size:12px; color: var(--muted);">Define when and where your event happens.</p>
              </div>
              <span class="pill" id="statusPill">Draft</span>
            </div>
            <div class="cardBody" id="formRoot">
              <div class="stepBody" data-step="0">
              <div class="field">
                <label for="eventName">Event Name (required)</label>
                <input id="eventName" type="text" placeholder="e.g., Odessa Charity Golf Classic" />
              </div>
              <div class="grid2">
                <div class="field">
                  <label for="eventDate">Event Date (required)</label>
                  <input id="eventDate" type="date" />
                </div>
                <div class="field">
                  <label for="timezone">Timezone (required)</label>
                  <select id="timezone">
                    <option value="America/Chicago" selected>America/Chicago</option>
                    <option value="America/Denver">America/Denver</option>
                    <option value="America/Los_Angeles">America/Los_Angeles</option>
                    <option value="America/New_York">America/New_York</option>
                    <option value="UTC">UTC</option>
                  </select>
                </div>
              </div>
              <div class="grid2">
                <div class="field">
                  <label for="startTime">Start Time (required)</label>
                  <input id="startTime" type="time" />
                </div>
                <div class="field">
                  <label for="endTime">End Time (optional)</label>
                  <input id="endTime" type="time" />
                </div>
              </div>
              <div class="field">
                <label for="location">Location (required)</label>
                <input id="location" type="text" placeholder="Venue name + address" />
              </div>
              <div class="field">
                <label for="eventType">Event Type</label>
                <select id="eventType">
                  <option value="charity">Charity</option>
                  <option value="sports">Sports</option>
                  <option value="trade">Trade</option>
                  <option value="property">Property</option>
                  <option value="custom" selected>Custom</option>
                </select>
              </div>
              </div>
              <div class="stepBody" data-step="1" style="display:none;">
              <div class="field">
                <label>Attendance Model</label>
                <div class="radioGroup" id="attendanceModel">
                  <label class="radio"><input type="radio" name="model" value="free" checked /> <span>Free</span></label>
                  <label class="radio"><input type="radio" name="model" value="paid" /> <span>Paid</span></label>
                  <label class="radio"><input type="radio" name="model" value="donation" /> <span>Donation</span></label>
                  <label class="radio"><input type="radio" name="model" value="invite_only" /> <span>Invite-only</span></label>
                </div>
              </div>

              <div id="blockFree" class="field">
                <label for="capacity">Capacity Limit (optional)</label>
                <input id="capacity" type="number" min="0" placeholder="e.g., 200" />
                <div class="hint">Leave blank if no capacity limit.</div>
              </div>

              <div id="blockPaid" style="display:none;">
                <div class="divider"></div>
                <div class="field">
                  <label>Ticket Tiers</label>
                  <div class="hint">At least one tier with name and price required.</div>
                </div>

                <div id="tiers"></div>

                <div class="row">
                  <button class="btn" type="button" id="addTierBtn">+ Add Tier</button>
                </div>
              </div>

              <div id="blockDonation" style="display:none;">
                <div class="divider"></div>
                <div class="field">
                  <label for="suggestedAmounts">Suggested Donation Amounts</label>
                  <input id="suggestedAmounts" type="text" placeholder="e.g., 25, 50, 100" />
                  <div class="hint">Comma-separated amounts. Attendees can pick one.</div>
                </div>

                <div class="toggle">
                  <div>
                    <strong>Allow Custom Amount</strong>
                    <small>Let donors enter any amount.</small>
                  </div>
                  <div class="switch" id="allowCustom" data-on="true"><div class="knob"></div></div>
                </div>
              </div>

              <div id="blockInvite" style="display:none;">
                <div class="divider"></div>
                <div class="toggle">
                  <div>
                    <strong>Invite Code Required</strong>
                    <small>Only attendees with a code can RSVP.</small>
                  </div>
                  <div class="switch" id="codeRequired" data-on="false"><div class="knob"></div></div>
                </div>

                <div class="field" id="inviteCodeWrap" style="display:none;">
                  <label for="inviteCode">Invite Code</label>
                  <input id="inviteCode" type="text" placeholder="e.g., VIP2026" />
                </div>
              </div>

</div>
              </div>
              <div class="stepBody" data-step="2" style="display:none;">
              <div class="toggle">
                <div>
                  <strong>Collect Email</strong>
                  <small>Recommended: confirmations and follow-ups.</small>
                </div>
                <div class="switch" id="collectEmail" data-on="true"><div class="knob"></div></div>
              </div>
              <div class="toggle">
                <div>
                  <strong>Collect Phone</strong>
                  <small>Required if you want SMS engagement.</small>
                </div>
                <div class="switch" id="collectPhone" data-on="false"><div class="knob"></div></div>
              </div>
              <div class="toggle" id="smsToggleWrap" style="display:none;">
                <div>
                  <strong>Enable SMS</strong>
                  <small>SMS requires attendee opt-in. RepQR handles consent at registration.</small>
                </div>
                <div class="switch" id="smsEnabled" data-on="false"><div class="knob"></div></div>
              </div>
              <div class="divider"></div>
              <div class="toggle">
                <div>
                  <strong>QR Check-In</strong>
                  <small>Track RSVPs vs actual attendance.</small>
                </div>
                <div class="switch" id="qrCheckin" data-on="true"><div class="knob"></div></div>
              </div>
              </div>
              <div class="stepBody" data-step="3" style="display:none;">
              <div class="toggle">
                <div>
                  <strong>Sponsors Enabled</strong>
                  <small>Enable sponsor tracking and sponsor-focused engagement.</small>
                </div>
                <div class="switch" id="sponsorsEnabled" data-on="false"><div class="knob"></div></div>
              </div>
              <div class="toggle">
                <div>
                  <strong>Automation Enabled</strong>
                  <small>Confirmations, reminders, thank-you, and post-event survey.</small>
                </div>
                <div class="switch" id="automationEnabled" data-on="true"><div class="knob"></div></div>
              </div>
              </div>
            </div>
            <div class="editorActions">
              <button type="button" class="btn" id="editorBackBtn">Back</button>
              <button type="button" class="btn btnPrimary" id="editorNextBtn">Next</button>
            </div>
          </div>
          <div class="actions">
            <button class="btn" type="button" id="resetBtn">Reset</button>
            <button class="btn btnPrimary" type="button" id="submitBtn" disabled>Complete required sections</button>
          </div>
        </div>
      </div>

    </div>
  </div>
  </div>
  <div id="commandCenterScreen" style="display:none;"></div>

<script>
  const EVENT_CONFIG_KEY = "repqr:eventConfig";
  const DEMO_MODE = true;

  // --------- Helpers ----------
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));

  function getStoredConfig(){
    try {
      const raw = localStorage.getItem(EVENT_CONFIG_KEY);
      return raw ? JSON.parse(raw) : null;
    } catch (e) { return null; }
  }

  function saveConfig(cfg){
    window.repqrEventConfig = cfg;
    try { localStorage.setItem(EVENT_CONFIG_KEY, JSON.stringify(cfg)); } catch (e) {}
  }

  function showRegistration(){ $("#registrationScreen").style.display = ""; $("#commandCenterScreen").style.display = "none"; }
  function showCommandCenter(){ $("#registrationScreen").style.display = "none"; $("#commandCenterScreen").style.display = ""; }

  var _demoMode = true;

  function getSampleConfig(){
    return {
      identity: { name: "Demo Charity Gala 2026", date: "2026-03-15", startTime: "18:00", endTime: "22:00", timezone: "America/Chicago", location: "Grand Ballroom, 123 Main St", type: "charity" },
      attendance: { model: "free", capacity: 200, ticketTiers: [], donation: { suggestedAmounts: [], allowCustom: false }, invite: { codeRequired: false, code: "" } },
      engagement: { collectEmail: true, collectPhone: true, smsEnabled: true, qrCheckin: true },
      system: { sponsorsEnabled: false, automationEnabled: true, published: false },
      eventAssets: { landingPageId: null, videoAssetId: null }
    };
  }

  function isEventDetailsCompleteFromConfig(c){
    const idn = c.identity || {};
    return !!(idn.name && (idn.name + "").trim() && idn.date && idn.startTime && idn.timezone && (idn.location && (idn.location + "").trim()));
  }
  function isAttendanceCompleteFromConfig(c){
    const att = c.attendance || {};
    if (att.model === "paid") {
      const tiers = att.ticketTiers || [];
      return tiers.some(t => (t.name && (t.name + "").trim()) && Number(t.price) >= 0);
    }
    return true;
  }
  function isEngagementCompleteFromConfig(c){
    const eng = c.engagement || {};
    return !!(eng.collectEmail || eng.collectPhone);
  }
  function isPublishReady(c){
    const assets = c.eventAssets || {};
    return isEventDetailsCompleteFromConfig(c) && isAttendanceCompleteFromConfig(c) && isEngagementCompleteFromConfig(c) && !!(assets.landingPageId) && !!(assets.videoAssetId);
  }

  function showToast(msg){
    const container = $("#toastContainer");
    if (!container) return;
    const el = document.createElement("div");
    el.className = "toast";
    el.textContent = msg;
    container.appendChild(el);
    setTimeout(() => { el.style.opacity = "0"; setTimeout(() => el.remove(), 200); }, 2800);
  }

  function demoAction(label){
    if (_demoMode) showToast("Demo: " + (label || "action simulated"));
  }

  function toggleSection(sectionEl){
    const open = sectionEl.getAttribute("data-open") === "true";
    sectionEl.setAttribute("data-open", String(!open));
  }

  function bindAccordion(){
    $$(".secHeader").forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-toggle");
        const section = document.querySelector(target);
        if(section) toggleSection(section);
      });
    });
  }

  function switchSet(el, on){
    el.setAttribute("data-on", on ? "true" : "false");
  }
  function switchGet(el){
    return el.getAttribute("data-on") === "true";
  }
  function bindSwitch(id, onChange){
    const el = $("#" + id);
    if (!el) return;
    el.addEventListener("click", () => {
      const next = !switchGet(el);
      switchSet(el, next);
      onChange?.(next);
      syncUI();
    });
  }

  // --------- Ticket tiers builder ----------
  let tierId = 0;

  function tierTemplate(id){
    return `
      <div class="tierRow" data-tier-id="${id}">
        <div class="field" style="margin:0;">
          <label>Tier Name</label>
          <input type="text" data-tier-name placeholder="e.g., General Admission" />
        </div>
        <div class="field" style="margin:0;">
          <label>Price</label>
          <input type="number" min="0" data-tier-price placeholder="50" />
        </div>
        <div class="field" style="margin:0;">
          <label>Qty</label>
          <input type="number" min="0" data-tier-qty placeholder="100" />
        </div>
        <div class="tierRemove">
          <button class="btn btnDanger" type="button" data-tier-remove>Remove</button>
        </div>
      </div>
    `;
  }

  function addTier(){
    const id = ++tierId;
    const wrap = $("#tiers");
    const tmp = document.createElement("div");
    tmp.innerHTML = tierTemplate(id);
    const row = tmp.firstElementChild;
    wrap.appendChild(row);

    row.querySelector("[data-tier-remove]").addEventListener("click", () => {
      row.remove();
      syncUI();
    });

    row.querySelectorAll("input").forEach(inp => inp.addEventListener("input", syncUI));
    syncUI();
  }

  // --------- State -> Config ----------
  function getAttendanceModel(){
    const r = document.querySelector('input[name="model"]:checked');
    return r ? r.value : "free";
  }

  function getTicketTiers(){
    return $$("#tiers .tierRow").map(row => {
      const name = row.querySelector("[data-tier-name]")?.value?.trim() || "";
      const price = Number(row.querySelector("[data-tier-price]")?.value || 0);
      const quantity = Number(row.querySelector("[data-tier-qty]")?.value || 0);
      return { name, price, quantity };
    }).filter(t => t.name || t.price || t.quantity);
  }

  function hasPaidTierWithNameAndPrice(){
    return $$("#tiers .tierRow").some(row => {
      const name = (row.querySelector("[data-tier-name]")?.value || "").trim();
      const price = Number(row.querySelector("[data-tier-price]")?.value || 0);
      return name.length > 0 && Number.isFinite(price) && price >= 0;
    });
  }

  function parseAmounts(s){
    return (s || "")
      .split(",")
      .map(x => x.trim())
      .filter(Boolean)
      .map(x => Number(x))
      .filter(n => Number.isFinite(n) && n >= 0);
  }

  function buildEventConfig(){
    const model = getAttendanceModel();
    const eventConfig = {
      identity: {
        name: $("#eventName").value.trim(),
        date: $("#eventDate").value || "",
        startTime: $("#startTime").value || "",
        endTime: $("#endTime").value || "",
        timezone: $("#timezone").value,
        location: $("#location").value.trim(),
        type: $("#eventType").value
      },
      attendance: {
        model,
        capacity: $("#capacity").value ? Number($("#capacity").value) : null,
        ticketTiers: model === "paid" ? getTicketTiers() : [],
        donation: {
          suggestedAmounts: model === "donation" ? parseAmounts($("#suggestedAmounts").value) : [],
          allowCustom: model === "donation" ? switchGet($("#allowCustom")) : false
        },
        invite: {
          codeRequired: model === "invite_only" ? switchGet($("#codeRequired")) : false,
          code: model === "invite_only" ? ($("#inviteCode").value.trim() || "") : ""
        }
      },
      engagement: {
        collectEmail: switchGet($("#collectEmail")),
        collectPhone: switchGet($("#collectPhone")),
        smsEnabled: switchGet($("#collectPhone")) ? switchGet($("#smsEnabled")) : false,
        qrCheckin: switchGet($("#qrCheckin"))
      },
      system: {
        sponsorsEnabled: switchGet($("#sponsorsEnabled")),
        automationEnabled: switchGet($("#automationEnabled"))
      }
    };
    return eventConfig;
  }

  var SECTION_ORDER = ["secDetails", "secAttendance", "secEngagement", "secSystem"];

  function isEventDetailsComplete(){
    const name = ($("#eventName").value || "").trim();
    const date = $("#eventDate").value || "";
    const startTime = $("#startTime").value || "";
    const timezone = $("#timezone").value || "";
    const location = ($("#location").value || "").trim();
    return name.length > 0 && date.length > 0 && startTime.length > 0 && timezone.length > 0 && location.length > 0;
  }

  function isAttendanceComplete(){
    const model = getAttendanceModel();
    if (model === "free") return true;
    if (model === "paid") return hasPaidTierWithNameAndPrice();
    if (model === "donation" || model === "invite_only") return true;
    return true;
  }

  function isEngagementComplete(){
    const email = switchGet($("#collectEmail"));
    const phone = switchGet($("#collectPhone"));
    return email || phone;
  }

  function setSectionStatus(sectionId, status){
    const dot = $("#" + sectionId + "Status");
    if (dot) dot.setAttribute("data-status", status);
  }

  function getSectionStatus(sectionId){
    const dot = $("#" + sectionId + "Status");
    return dot ? dot.getAttribute("data-status") : "not_started";
  }

  function openSection(sectionId){
    const section = $("#" + sectionId);
    if (section) section.setAttribute("data-open", "true");
  }

  function closeSection(sectionId){
    const section = $("#" + sectionId);
    if (section) section.setAttribute("data-open", "false");
  }

  function isSectionOpen(sectionId){
    const section = $("#" + sectionId);
    return section ? section.getAttribute("data-open") === "true" : false;
  }

  var SECTION_NAMES = { secDetails: "Event Details", secAttendance: "Attendance", secEngagement: "Engagement", secSystem: "System" };
  var REG_STEP_SUBTITLES = ["Define when and where your event happens.", "Decide how guests register and pay.", "Choose how you'll capture guests and track attendance.", "Enable sponsors and automated messaging."];
  var _currentStep = 0;

  function setStep(i){
    i = Math.max(0, Math.min(3, i));
    _currentStep = i;
    $$(".stepCard").forEach((card, idx) => {
      card.classList.toggle("active", idx === i);
    });
    $$(".stepBody").forEach((body, idx) => {
      body.style.display = idx === i ? "block" : "none";
    });
    const titleEl = $("#editorStepTitle");
    const subEl = $("#editorStepSubtitle");
    if (titleEl) titleEl.textContent = Object.values(SECTION_NAMES)[i];
    if (subEl) subEl.textContent = REG_STEP_SUBTITLES[i];
    const backBtn = $("#editorBackBtn");
    const nextBtn = $("#editorNextBtn");
    if (backBtn) backBtn.style.visibility = i === 0 ? "hidden" : "visible";
    if (nextBtn) nextBtn.textContent = i === 3 ? "Done" : "Next";
  }

  // --------- UI Sync (toggle reveal + completion state) ----------
  function syncUI(){
    const model = getAttendanceModel();
    $("#blockFree").style.display = (model === "free") ? "block" : "none";
    $("#blockPaid").style.display = (model === "paid") ? "block" : "none";
    $("#blockDonation").style.display = (model === "donation") ? "block" : "none";
    $("#blockInvite").style.display = (model === "invite_only") ? "block" : "none";

    const codeReq = switchGet($("#codeRequired"));
    $("#inviteCodeWrap").style.display = codeReq ? "block" : "none";

    const phoneOn = switchGet($("#collectPhone"));
    $("#smsToggleWrap").style.display = phoneOn ? "flex" : "none";
    if(!phoneOn) switchSet($("#smsEnabled"), false);

    const detailsOk = isEventDetailsComplete();
    const attendanceOk = isAttendanceComplete();
    const engagementOk = isEngagementComplete();

    // Step rail: status dots and Missing / complete lines
    const detailsMissing = [];
    if (!($("#eventName").value || "").trim()) detailsMissing.push("Event name");
    if (!$("#eventDate").value) detailsMissing.push("Event date");
    if (!$("#startTime").value) detailsMissing.push("Start time");
    if (!$("#timezone").value) detailsMissing.push("Timezone");
    if (!($("#location").value || "").trim()) detailsMissing.push("Location");
    const detailsStatus = detailsMissing.length === 0 ? "complete" : (detailsMissing.length < 5 ? "in_progress" : "not_started");
    const d0 = $("#stepDot0");
    if (d0) d0.setAttribute("data-status", detailsStatus);
    const s0 = $("#stepCard0Status");
    if (s0) { s0.textContent = detailsMissing.length > 0 ? "Missing: " + detailsMissing.join(", ") : "✓ Section complete"; s0.classList.toggle("complete", detailsOk); }

    const attendanceMissing = [];
    if (model === "paid" && !hasPaidTierWithNameAndPrice()) attendanceMissing.push("at least one ticket tier with name and price");
    const attendanceStatus = attendanceOk ? "complete" : (attendanceMissing.length > 0 ? "in_progress" : "not_started");
    const d1 = $("#stepDot1");
    if (d1) d1.setAttribute("data-status", attendanceStatus);
    const s1 = $("#stepCard1Status");
    if (s1) { s1.textContent = attendanceMissing.length > 0 ? "Missing: " + attendanceMissing.join(", ") : "✓ Section complete"; s1.classList.toggle("complete", attendanceOk); }

    const engagementMissing = [];
    if (!engagementOk) engagementMissing.push("at least one of Collect Email or Collect Phone");
    const engagementStatus = engagementOk ? "complete" : "in_progress";
    const d2 = $("#stepDot2");
    if (d2) d2.setAttribute("data-status", engagementStatus);
    const s2 = $("#stepCard2Status");
    if (s2) { s2.textContent = engagementMissing.length > 0 ? "Missing: " + engagementMissing.join(", ") : "✓ Section complete"; s2.classList.toggle("complete", engagementOk); }

    const d3 = $("#stepDot3");
    if (d3) d3.setAttribute("data-status", "complete");
    const s3 = $("#stepCard3Status");
    if (s3) { s3.textContent = "✓ Section complete"; s3.classList.add("complete"); }

    const canSubmit = DEMO_MODE || (detailsOk && attendanceOk && engagementOk);
    const submitBtn = $("#submitBtn");
    if (submitBtn) {
      if (DEMO_MODE) {
        submitBtn.disabled = false;
        submitBtn.textContent = "Enter Command Center (Demo)";
      } else {
        submitBtn.disabled = !canSubmit;
        submitBtn.textContent = canSubmit ? "Create Event & Open Command Center" : "Complete required sections";
      }
    }

    const statusPill = $("#statusPill");
    if (statusPill) statusPill.textContent = (DEMO_MODE || canSubmit) ? "Ready" : "Draft";
  }

  function resetAll(){
    $("#eventName").value = "";
    $("#eventDate").value = "";
    $("#startTime").value = "";
    $("#endTime").value = "";
    $("#location").value = "";
    $("#eventType").value = "custom";
    $("#timezone").value = "America/Chicago";

    document.querySelector('input[name="model"][value="free"]').checked = true;
    $("#capacity").value = "";
    $("#suggestedAmounts").value = "";
    $("#inviteCode").value = "";
    switchSet($("#allowCustom"), true);
    switchSet($("#codeRequired"), false);

    $("#tiers").innerHTML = "";
    tierId = 0;

    switchSet($("#collectEmail"), true);
    switchSet($("#collectPhone"), false);
    switchSet($("#smsEnabled"), false);
    switchSet($("#qrCheckin"), true);

    switchSet($("#sponsorsEnabled"), false);
    switchSet($("#automationEnabled"), true);

    setStep(0);
    syncUI();
  }

  // --------- Init ----------
  function init(){
    setStep(0);
    $$(".stepCard").forEach(card => {
      card.addEventListener("click", () => setStep(Number(card.getAttribute("data-step"))));
    });
    $("#editorBackBtn")?.addEventListener("click", () => setStep(_currentStep - 1));
    $("#editorNextBtn")?.addEventListener("click", () => { if (_currentStep < 3) setStep(_currentStep + 1); });

    // inputs -> sync
    ["eventName","eventDate","startTime","endTime","location","eventType","timezone","capacity","suggestedAmounts","inviteCode"]
      .forEach(id => {
        const el = $("#" + id);
        if (el) {
          el.addEventListener("input", syncUI);
          el.addEventListener("change", syncUI);
        }
      });

    $$('#attendanceModel input[type="radio"]').forEach(r => r.addEventListener("change", () => {
      if(getAttendanceModel() === "paid" && $$("#tiers .tierRow").length === 0) addTier();
      syncUI();
    }));

    bindSwitch("allowCustom");
    bindSwitch("codeRequired");
    bindSwitch("collectEmail");
    bindSwitch("collectPhone");
    bindSwitch("smsEnabled");
    bindSwitch("qrCheckin");
    bindSwitch("sponsorsEnabled");
    bindSwitch("automationEnabled");

    $("#addTierBtn").addEventListener("click", addTier);
    $("#resetBtn").addEventListener("click", resetAll);

    $("#submitBtn").addEventListener("click", () => {
      if (DEMO_MODE) {
        const nameEl = $("#eventName"), dateEl = $("#eventDate"), startEl = $("#startTime"), tzEl = $("#timezone"), locEl = $("#location");
        if (!(nameEl.value || "").trim()) nameEl.value = "Demo Event";
        if (!dateEl.value) { const d = new Date(); dateEl.value = d.toISOString().slice(0, 10); }
        if (!startEl.value) startEl.value = "18:00";
        if (!tzEl.value) tzEl.value = "America/Chicago";
        if (!(locEl.value || "").trim()) locEl.value = "Demo Venue";
      }
      const fresh = buildEventConfig();
      const existing = getStoredConfig();
      const cfg = {
        ...fresh,
        eventAssets: existing?.eventAssets || { landingPageId: null, videoAssetId: null },
        system: { ...fresh.system, published: !!(existing?.system && existing.system.published) }
      };
      saveConfig(cfg);
      console.log("repqrEventConfig:", cfg);
      showCommandCenter();
      _ccActiveTab = "overview";
      renderCommandCenter(cfg);
    });

    // seed
    syncUI();

    if (getStoredConfig()) $("#resumeStrip").classList.remove("hide");
    $("#resumeEventBtn").addEventListener("click", () => {
      const cfg = getStoredConfig();
      if (cfg) {
        window.repqrEventConfig = cfg;
        showCommandCenter();
        _ccActiveTab = "overview";
        renderCommandCenter(cfg);
      }
    });
  }

  // --------- Command Center ----------
  var _ccConfig = null;
  var _ccActiveTab = "overview";

  function runOverviewCountUp(){
    const content = $("#ccContent");
    if (!content || _ccActiveTab !== "overview") return;
    const els = content.querySelectorAll("[data-cc-count]");
    const duration = 600;
    const start = Date.now();
    function tick(){
      const t = Math.min((Date.now() - start) / duration, 1);
      const ease = 1 - Math.pow(1 - t, 2);
      els.forEach(el => {
        const end = Number(el.getAttribute("data-cc-count")) || 0;
        const suffix = el.getAttribute("data-cc-suffix") || "";
        const val = Math.round(ease * end);
        el.textContent = val + suffix;
      });
      if (t < 1) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  }

  function renderCommandCenter(config){
    _ccConfig = config || getStoredConfig() || window.repqrEventConfig;
    if (!_ccConfig && _demoMode) _ccConfig = getSampleConfig();
    if (!_ccConfig) return;
    const id = $("#commandCenterScreen");
    if (!id) return;
    const c = _ccConfig;
    c.eventAssets = c.eventAssets || { landingPageId: null, videoAssetId: null };
    c.system = c.system || {};
    if (c.system.published === undefined) c.system.published = false;
    const idn = c.identity || {};
    const att = c.attendance || {};
    const eng = c.engagement || {};
    const sys = c.system || {};
    const sponsorsOn = !!sys.sponsorsEnabled;
    const assets = c.eventAssets || {};
    const published = !!sys.published;
    const publishReady = isPublishReady(c);

    const navItems = [
      { key: "overview", label: "Overview" },
      { key: "assets", label: "Assets" },
      { key: "messaging", label: "Messaging" },
      { key: "contacts", label: "Contacts" }
    ];
    if (sponsorsOn) navItems.push({ key: "sponsors", label: "Sponsors" });
    navItems.push({ key: "settings", label: "Settings" });

    let navHtml = navItems.map(n => '<button type="button" class="ccNavBtn' + (n.key === _ccActiveTab ? ' active' : '') + '" data-tab="' + n.key + '">' + n.label + '</button>').join('');

    const statusPillLabel = published ? "Published" : (publishReady ? "Ready to Publish" : "Draft");
    const publishBtnDisabled = !publishReady || published;
    const publishBtnTitle = publishBtnDisabled ? "Complete required items to publish." : "";
    const demoToggleHtml = '<div class="ccDemoToggle"><span>Demo Mode</span><div class="switch" id="ccDemoToggle" data-on="' + (_demoMode ? 'true' : 'false') + '"><div class="knob"></div></div></div>';
    id.innerHTML = '<div class="ccWrap"><div class="ccHeader"><h1>' + (idn.name || "Event") + '</h1><div class="ccActions"><span class="pill" id="ccStatusPill">' + statusPillLabel + '</span><button type="button" class="btn btnPrimary" id="ccPublishBtn" ' + (publishBtnDisabled ? 'disabled title="' + publishBtnTitle.replace(/"/g, "&quot;") + '"' : '') + '>Publish Event</button>' + demoToggleHtml + '<button type="button" class="btn ghost" id="ccEditSetup">Edit Setup</button></div></div><div class="ccLayout"><nav class="ccNav">' + navHtml + '</nav><div class="ccContent" id="ccContent"></div></div></div>';

    id.querySelectorAll(".ccNavBtn").forEach(btn => {
      btn.addEventListener("click", () => {
        _ccActiveTab = btn.getAttribute("data-tab");
        renderCommandCenter(_ccConfig);
      });
    });
    $("#ccEditSetup").addEventListener("click", () => {
      hydrateRegistration(_ccConfig);
      showRegistration();
    });
    const demoEl = $("#ccDemoToggle");
    if (demoEl) demoEl.addEventListener("click", () => {
      _demoMode = demoEl.getAttribute("data-on") !== "true";
      demoEl.setAttribute("data-on", _demoMode ? "true" : "false");
      renderCommandCenter(_ccConfig);
    });
    $("#ccPublishBtn")?.addEventListener("click", () => {
      if (published || !publishReady) return;
      if (_demoMode) showToast("Demo: Event published.");
      const updated = { ..._ccConfig, system: { ..._ccConfig.system, published: true } };
      saveConfig(updated);
      _ccConfig = updated;
      renderCommandCenter(updated);
    });

    const content = $("#ccContent");
    if (!content) return;

    if (_ccActiveTab === "overview") {
      const enableSponsorsLink = (_demoMode && !sponsorsOn) ? '<p style="margin:12px 0 0;font-size:12px;"><a href="#" class="link" id="ccEnableSponsorsDemo">Enable Sponsors (Demo)</a></p>' : '';
      content.innerHTML = '<div class="ccStatGrid">' +
        '<div class="ccStatCard"><div class="ccStatValue" data-cc-count="142">0</div><div class="ccStatLabel">RSVPs</div></div>' +
        '<div class="ccStatCard"><div class="ccStatValue" data-cc-count="89">0</div><div class="ccStatLabel">Check-ins</div></div>' +
        '<div class="ccStatCard"><div class="ccStatValue" data-cc-count="156">0</div><div class="ccStatLabel">QR Scans</div></div>' +
        '<div class="ccStatCard"><div class="ccStatValue" data-cc-count="63" data-cc-suffix="%">0</div><div class="ccStatLabel">Engagement %</div></div>' +
        '</div>' +
        '<div class="card ccCard"><div class="cardHead"><div class="ccActivityHeader"><span class="ccPulse"></span><h2 style="margin:0;">Live Activity</h2></div></div><div class="cardBody">' +
        '<div class="ccActivityItem">12:14 PM — QR scanned at Check-in</div>' +
        '<div class="ccActivityItem">12:18 PM — RSVP submitted</div>' +
        '<div class="ccActivityItem">12:22 PM — Sponsor booth scan</div>' +
        '<div class="ccActivityItem">12:25 PM — Check-in at door</div>' +
        '<div class="ccActivityItem">12:28 PM — RSVP submitted</div>' +
        enableSponsorsLink + '</div></div>';
      runOverviewCountUp();
      const enableSponsorsBtn = content.querySelector("#ccEnableSponsorsDemo");
      if (enableSponsorsBtn) enableSponsorsBtn.addEventListener("click", (e) => { e.preventDefault(); const u = { ..._ccConfig, system: { ..._ccConfig.system, sponsorsEnabled: true } }; saveConfig(u); _ccConfig = u; renderCommandCenter(u); });
    } else if (_ccActiveTab === "assets") {
      const detailsOk = isEventDetailsCompleteFromConfig(c);
      const attOk = isAttendanceCompleteFromConfig(c);
      const engOk = isEngagementCompleteFromConfig(c);
      const hasLanding = !!assets.landingPageId;
      const hasVideo = !!assets.videoAssetId;
      const check = "✓";
      const req1 = detailsOk ? check : "—";
      const req2 = attOk ? check : "—";
      const req3 = engOk ? check : "—";
      const req4 = hasLanding ? check : "—";
      const req5 = hasVideo ? check : "—";
      const optContacts = "—";
      const optSponsors = sponsorsOn ? "—" : "";
      const checklistHtml = '<div class="card ccCard"><div class="cardHead"><h2>Readiness Checklist</h2></div><div class="cardBody">' +
        '<p style="margin:0 0 8px; font-size:11px; text-transform:uppercase; letter-spacing:.05em; color: var(--muted);">Required</p>' +
        '<ul class="ccChecklist">' +
        '<li>' + req1 + ' Event Details complete</li>' +
        '<li>' + req2 + ' Attendance configured</li>' +
        '<li>' + req3 + ' Engagement configured</li>' +
        '<li>' + req4 + ' Landing Page attached</li>' +
        '<li>' + req5 + ' Event Video attached</li>' +
        '</ul>' +
        '<p style="margin:14px 0 8px; font-size:11px; text-transform:uppercase; letter-spacing:.05em; color: var(--muted);">Optional</p>' +
        '<ul class="ccChecklist">' +
        '<li>' + optContacts + ' Contacts imported</li>' +
        (sponsorsOn ? '<li>' + optSponsors + ' Sponsors set up</li>' : '') +
        '</ul></div></div>';
      const descHtml = '<p style="margin:0 0 16px; font-size:13px; color: var(--muted);">Attach the landing page and event video for this event. Edit them anytime in the RepQR libraries—changes update here automatically.</p>';
      const landingEmpty = !hasLanding ? '<p style="margin:0 0 12px; font-size:13px; color: var(--muted);">Your event needs a landing page to collect RSVPs and deliver the experience.</p><button type="button" class="btn btnPrimary" id="assetsCreateLanding">Create Landing Page</button> <button type="button" class="btn ghost" id="assetsOpenLandingLib">Open in Landing Page Library</button>' : '<p style="margin:0 0 8px; font-size:13px;">Landing page attached.</p><button type="button" class="btn ghost" id="assetsOpenLandingLib">Open in Landing Page Library</button>';
      const videoEmpty = !hasVideo ? '<p style="margin:0 0 12px; font-size:13px; color: var(--muted);">Add a welcome video to drive engagement and conversions.</p><button type="button" class="btn btnPrimary" id="assetsCreateVideo">Create Video</button> <button type="button" class="btn ghost" id="assetsOpenVideoLib">Open in Video Library</button>' : '<p style="margin:0 0 8px; font-size:13px;">Event video attached.</p><button type="button" class="btn ghost" id="assetsOpenVideoLib">Open in Video Library</button>';
      content.innerHTML = checklistHtml + descHtml +
        '<div class="card ccCard"><div class="cardHead"><h2>Landing Page</h2></div><div class="cardBody">' + landingEmpty + '</div></div>' +
        '<div class="card ccCard"><div class="cardHead"><h2>Event Video</h2></div><div class="cardBody">' + videoEmpty + '</div></div>';
      $("#assetsCreateLanding")?.addEventListener("click", () => { if (_demoMode) showToast("Demo: Opening RepQR Landing Page Builder…"); const u = { ..._ccConfig, eventAssets: { ..._ccConfig.eventAssets, landingPageId: _ccConfig.eventAssets.landingPageId || "demo-landing-" + Date.now() } }; saveConfig(u); _ccConfig = u; renderCommandCenter(u); });
      $("#assetsCreateVideo")?.addEventListener("click", () => { if (_demoMode) showToast("Demo: Opening RepQR Video Studio…"); const u = { ..._ccConfig, eventAssets: { ..._ccConfig.eventAssets, videoAssetId: _ccConfig.eventAssets.videoAssetId || "demo-video-" + Date.now() } }; saveConfig(u); _ccConfig = u; renderCommandCenter(u); });
      $("#assetsOpenLandingLib")?.addEventListener("click", () => { if (_demoMode) showToast("Demo: Opening Landing Page Library…"); });
      $("#assetsOpenVideoLib")?.addEventListener("click", () => { if (_demoMode) showToast("Demo: Opening Video Library…"); });
    } else if (_ccActiveTab === "messaging") {
      const emailOff = !eng.collectEmail;
      const smsOff = !eng.smsEnabled;
      const callout = (emailOff || smsOff) ? '<div class="ccCallout">Currently disabled by Setup settings. (Demo mode allows preview anyway.)</div>' : '';
      content.innerHTML = callout +
        '<div class="card ccCard"><div class="cardHead"><h2>Email</h2></div><div class="cardBody">' +
        '<div class="field"><label>Template</label><select id="msgEmailTemplate"><option>Confirmation</option><option>Reminder</option><option>Thank You</option></select></div>' +
        '<div class="field"><label>Subject</label><input type="text" id="msgEmailSubject" placeholder="Event reminder" /></div>' +
        '<div class="field"><label>Message</label><textarea id="msgEmailBody" rows="4" placeholder="Message body..."></textarea></div>' +
        '<div class="field"><label>Recipients</label><select id="msgEmailSegment"><option>All RSVPs</option><option>VIP</option><option>No-shows</option></select></div>' +
        '<button type="button" class="btn btnPrimary" id="msgEmailPreviewSend">Preview Send</button></div></div>' +
        '<div class="card ccCard"><div class="cardHead"><h2>SMS</h2></div><div class="cardBody">' +
        '<div class="field"><label>Template</label><select id="msgSmsTemplate"><option>Confirmation</option><option>Reminder</option><option>Thank You</option></select></div>' +
        '<div class="field"><label>Message</label><textarea id="msgSmsBody" rows="4" placeholder="SMS body..."></textarea></div>' +
        '<div class="field"><label>Recipients</label><select id="msgSmsSegment"><option>All RSVPs</option><option>VIP</option><option>No-shows</option></select></div>' +
        '<button type="button" class="btn btnPrimary" id="msgSmsPreviewSend">Preview Send</button></div></div>';
      $("#msgEmailPreviewSend")?.addEventListener("click", () => demoAction("email send simulated"));
      $("#msgSmsPreviewSend")?.addEventListener("click", () => demoAction("SMS send simulated"));
    } else if (_ccActiveTab === "contacts") {
      content.innerHTML = '<div class="card ccCard"><div class="cardHead"><h2>Contacts Import</h2></div><div class="cardBody">' +
        '<div class="field"><label>Upload</label><input type="file" id="contactsFile" accept=".csv,.xlsx" style="margin-bottom:8px;" /><span id="contactsFileName" style="font-size:12px;color:var(--muted);"></span></div>' +
        '<div class="field"><label>Or paste list</label><textarea id="contactsPaste" rows="3" placeholder="Name, Email, Phone..."></textarea></div>' +
        '<button type="button" class="btn btnPrimary" id="contactsPreviewImport">Preview Import</button></div></div>' +
        '<div class="card ccCard"><div class="cardHead"><h2>Contacts</h2></div><div class="cardBody"><div style="overflow-x:auto;"><table class="table" style="width:100%;font-size:13px;"><thead><tr><th>Name</th><th>Email</th><th>Segment</th></tr></thead><tbody>' +
        '<tr><td>Alex Morgan</td><td>alex@example.com</td><td><span style="background:var(--ok);color:#111;padding:2px 6px;border-radius:4px;font-size:11px;">VIP</span></td></tr>' +
        '<tr><td>Jamie Lee</td><td>jamie@example.com</td><td><span style="background:rgba(255,255,255,.2);padding:2px 6px;border-radius:4px;font-size:11px;">GA</span></td></tr>' +
        '<tr><td>Sam Chen</td><td>sam@example.com</td><td><span style="background:var(--ok);color:#111;padding:2px 6px;border-radius:4px;font-size:11px;">VIP</span></td></tr>' +
        '<tr><td>Jordan Taylor</td><td>jordan@example.com</td><td><span style="background:rgba(255,255,255,.2);padding:2px 6px;border-radius:4px;font-size:11px;">GA</span></td></tr>' +
        '<tr><td>Riley Davis</td><td>riley@example.com</td><td><span style="background:rgba(255,255,255,.2);padding:2px 6px;border-radius:4px;font-size:11px;">GA</span></td></tr>' +
        '<tr><td>Casey Brown</td><td>casey@example.com</td><td><span style="background:var(--ok);color:#111;padding:2px 6px;border-radius:4px;font-size:11px;">VIP</span></td></tr>' +
        '<tr><td>Morgan Wright</td><td>morgan@example.com</td><td><span style="background:rgba(255,255,255,.2);padding:2px 6px;border-radius:4px;font-size:11px;">GA</span></td></tr>' +
        '<tr><td>Avery Clark</td><td>avery@example.com</td><td><span style="background:rgba(255,255,255,.2);padding:2px 6px;border-radius:4px;font-size:11px;">GA</span></td></tr>' +
        '<tr><td>Quinn Martinez</td><td>quinn@example.com</td><td><span style="background:var(--ok);color:#111;padding:2px 6px;border-radius:4px;font-size:11px;">VIP</span></td></tr>' +
        '<tr><td>Skyler Adams</td><td>skyler@example.com</td><td><span style="background:rgba(255,255,255,.2);padding:2px 6px;border-radius:4px;font-size:11px;">GA</span></td></tr>' +
        '</tbody></table></div></div></div>';
      $("#contactsFile")?.addEventListener("change", function(){ $("#contactsFileName").textContent = this.files?.length ? this.files[0].name : ""; });
      $("#contactsPreviewImport")?.addEventListener("click", () => demoAction("import simulated"));
    } else if (_ccActiveTab === "sponsors") {
      content.innerHTML = '<div class="card ccCard"><div class="cardHead"><h2>Sponsor list</h2></div><div class="cardBody"><ul style="margin:0;padding-left:18px;font-size:13px;">' +
        '<li>Acme Corp</li><li>TechStart Inc</li><li>Global Partners</li></ul></div></div>' +
        '<div class="card ccCard"><div class="cardHead"><h2>Sponsor performance</h2></div><div class="cardBody"><div style="overflow-x:auto;"><table class="table" style="width:100%;font-size:13px;"><thead><tr><th>Sponsor</th><th>Scans</th><th>Leads</th></tr></thead><tbody>' +
        '<tr><td>Acme Corp</td><td>42</td><td>18</td></tr><tr><td>TechStart Inc</td><td>28</td><td>12</td></tr><tr><td>Global Partners</td><td>35</td><td>9</td></tr></tbody></table></div>' +
        '<button type="button" class="btn btnPrimary" id="sponsorsPreviewReport" style="margin-top:12px;">Preview Sponsor Report</button></div></div>';
      $("#sponsorsPreviewReport")?.addEventListener("click", () => demoAction("sponsor report simulated"));
    } else if (_ccActiveTab === "settings") {
      content.innerHTML = renderSettingsTab();
      bindSettingsTab();
    }
  }

  function renderSettingsTab(){
    const c = _ccConfig;
    if (!c) return "";
    const idn = c.identity || {};
    const att = c.attendance || {};
    const eng = c.engagement || {};
    const sys = c.system || {};
    return '<div class="card ccCard"><div class="cardHead"><h2>Settings</h2><p style="margin:6px 0 0;color:var(--muted);font-size:12.5px;">Edit event setup. Save to apply.</p></div><div class="cardBody">' +
      '<div class="field"><label>Event Name</label><input type="text" id="ccSetName" value="' + (idn.name || "").replace(/"/g, "&quot;") + '" /></div>' +
      '<div class="grid2"><div class="field"><label>Date</label><input type="date" id="ccSetDate" value="' + (idn.date || "") + '" /></div><div class="field"><label>Timezone</label><select id="ccSetTimezone"><option value="America/Chicago"' + (idn.timezone === "America/Chicago" ? " selected" : "") + '>America/Chicago</option><option value="America/Denver"' + (idn.timezone === "America/Denver" ? " selected" : "") + '>America/Denver</option><option value="America/Los_Angeles"' + (idn.timezone === "America/Los_Angeles" ? " selected" : "") + '>America/Los_Angeles</option><option value="America/New_York"' + (idn.timezone === "America/New_York" ? " selected" : "") + '>America/New_York</option><option value="UTC"' + (idn.timezone === "UTC" ? " selected" : "") + '>UTC</option></select></div></div>' +
      '<div class="grid2"><div class="field"><label>Start Time</label><input type="time" id="ccSetStartTime" value="' + (idn.startTime || "") + '" /></div><div class="field"><label>End Time</label><input type="time" id="ccSetEndTime" value="' + (idn.endTime || "") + '" /></div></div>' +
      '<div class="field"><label>Location</label><input type="text" id="ccSetLocation" value="' + (idn.location || "").replace(/"/g, "&quot;") + '" /></div>' +
      '<div class="field"><label>Event Type</label><select id="ccSetType"><option value="charity"' + (idn.type === "charity" ? " selected" : "") + '>Charity</option><option value="sports"' + (idn.type === "sports" ? " selected" : "") + '>Sports</option><option value="trade"' + (idn.type === "trade" ? " selected" : "") + '>Trade</option><option value="property"' + (idn.type === "property" ? " selected" : "") + '>Property</option><option value="custom"' + (idn.type === "custom" ? " selected" : "") + '>Custom</option></select></div>' +
      '<div class="divider"></div><p style="font-size:12px;color:var(--muted);margin:0 0 10px;">Attendance: ' + (att.model || "free") + '</p>' +
      '<div class="divider"></div><div class="toggle"><div><strong>Collect Email</strong></div><div class="switch" id="ccSetCollectEmail" data-on="' + (eng.collectEmail ? "true" : "false") + '"><div class="knob"></div></div></div>' +
      '<div class="toggle"><div><strong>Collect Phone</strong></div><div class="switch" id="ccSetCollectPhone" data-on="' + (eng.collectPhone ? "true" : "false") + '"><div class="knob"></div></div></div>' +
      '<div class="toggle"><div><strong>QR Check-in</strong></div><div class="switch" id="ccSetQrCheckin" data-on="' + (eng.qrCheckin ? "true" : "false") + '"><div class="knob"></div></div></div>' +
      '<div class="divider"></div><div class="toggle"><div><strong>Sponsors Enabled</strong></div><div class="switch" id="ccSetSponsors" data-on="' + (sys.sponsorsEnabled ? "true" : "false") + '"><div class="knob"></div></div></div>' +
      '<div class="toggle"><div><strong>Automation Enabled</strong></div><div class="switch" id="ccSetAutomation" data-on="' + (sys.automationEnabled ? "true" : "false") + '"><div class="knob"></div></div></div>' +
      '<div class="actions" style="margin-top:16px;"><button type="button" class="btn btnPrimary" id="ccSaveSettings">Save Settings</button> <button type="button" class="btn ghost" id="ccResetDemo">Reset to Demo Defaults</button></div></div></div>';
  }

  function bindSettingsTab(){
    const wrap = $("#ccContent");
    if (!wrap) return;
    ["ccSetCollectEmail","ccSetCollectPhone","ccSetQrCheckin","ccSetSponsors","ccSetAutomation"].forEach(id => {
      const el = $("#" + id);
      if (!el) return;
      el.addEventListener("click", () => {
        const on = el.getAttribute("data-on") !== "true";
        el.setAttribute("data-on", on ? "true" : "false");
      });
    });
    const saveBtn = $("#ccSaveSettings");
    if (!saveBtn) return;
    saveBtn.addEventListener("click", () => {
      const idn = _ccConfig.identity || {};
      const eng = _ccConfig.engagement || {};
      const sys = _ccConfig.system || {};
      const updated = {
        ..._ccConfig,
        identity: { ...idn, name: $("#ccSetName").value.trim(), date: $("#ccSetDate").value, startTime: $("#ccSetStartTime").value, endTime: $("#ccSetEndTime").value, timezone: $("#ccSetTimezone").value, location: $("#ccSetLocation").value.trim(), type: $("#ccSetType").value },
        engagement: { ...eng, collectEmail: $("#ccSetCollectEmail").getAttribute("data-on") === "true", collectPhone: $("#ccSetCollectPhone").getAttribute("data-on") === "true", qrCheckin: $("#ccSetQrCheckin").getAttribute("data-on") === "true" },
        system: { ...sys, sponsorsEnabled: $("#ccSetSponsors").getAttribute("data-on") === "true", automationEnabled: $("#ccSetAutomation").getAttribute("data-on") === "true" }
      };
      saveConfig(updated);
      _ccConfig = updated;
      renderCommandCenter(updated);
    });
    const resetBtn = $("#ccResetDemo");
    if (resetBtn) resetBtn.addEventListener("click", () => {
      const defaults = getSampleConfig();
      saveConfig(defaults);
      _ccConfig = defaults;
      renderCommandCenter(defaults);
      showToast("Demo: reset to defaults");
    });
  }

  function hydrateRegistration(cfg){
    if (!cfg) return;
    const idn = cfg.identity || {};
    const att = cfg.attendance || {};
    const don = att.donation || {};
    const inv = att.invite || {};
    const eng = cfg.engagement || {};
    const sys = cfg.system || {};
    $("#eventName").value = idn.name || "";
    $("#eventDate").value = idn.date || "";
    $("#startTime").value = idn.startTime || "";
    $("#endTime").value = idn.endTime || "";
    $("#timezone").value = idn.timezone || "America/Chicago";
    $("#location").value = idn.location || "";
    $("#eventType").value = idn.type || "custom";
    const model = att.model || "free";
    document.querySelectorAll('input[name="model"]').forEach(r => { r.checked = r.value === model; });
    $("#capacity").value = att.capacity != null ? att.capacity : "";
    $("#suggestedAmounts").value = (don.suggestedAmounts || []).join(", ");
    $("#inviteCode").value = inv.code || "";
    switchSet($("#allowCustom"), !!don.allowCustom);
    switchSet($("#codeRequired"), !!inv.codeRequired);
    const tiers = att.ticketTiers || [];
    $("#tiers").innerHTML = "";
    tierId = 0;
    tiers.forEach(t => { addTier(); const rows = $$("#tiers .tierRow"); const row = rows[rows.length - 1]; if (row) { row.querySelector("[data-tier-name]").value = t.name || ""; row.querySelector("[data-tier-price]").value = t.price != null ? t.price : ""; row.querySelector("[data-tier-qty]").value = t.quantity != null ? t.quantity : ""; } });
    switchSet($("#collectEmail"), !!eng.collectEmail);
    switchSet($("#collectPhone"), !!eng.collectPhone);
    switchSet($("#smsEnabled"), !!eng.smsEnabled);
    switchSet($("#qrCheckin"), !!eng.qrCheckin);
    switchSet($("#sponsorsEnabled"), !!sys.sponsorsEnabled);
    switchSet($("#automationEnabled"), !!sys.automationEnabled);
    syncUI();
  }

  init();
</script>
</body>
</html>
